Привет!

В этом файле я попробую описать, что я пытался сделать в рамках конкурса
расширений для SemanticNT, что я сделал и почему так, и немного коснусь
реализации некоторых моментов.

Но сперва хочу сказать спасибо за собственно сам проект, он крут, и за конкурс,
в любом случае было интересно поработать.

К делу.

Идея проекта мне изначально очень понравилась. Сам регулярно пользую
подобные сервисы, и смотрю на их будущее позитивно. Самым
главным в сервисах онлайн курсов я считаю собственно онлайн курс, а это
как правило некоторый набор видеолекций и связанный с ним набор
материалов.
Собственно на видеолекциях я и решил сконцентрироваться. Хотелось сделать
удобное пространство для просмотра лекции.
В некоторых случаях помимо видео нужны презентации, это особенно
актуально для лекций в форме докладов. Многие лекторы в нашем университете
используют презентации, и например лекции профессора Боярского К.К (физик)
без презентаций теряют очень много, а я бы их послушал онлайн, особенно курс
по квантовой физике. Поэтому к видео я решил добавть еще и презентации.

Теперь наверно самое время попробовать открыть то, что я там наваял.
Скорее всего на тех записях, что есть в Вашей БД ничего работать не будет,
т.к. я несколько изменил структуру курса. Для разработки я сделал курс под
номером CS0010, он почти копия курса CS0001, с разницей в папку lectures,
где для каждой лекции есть собственная директория, в которой предполагается
хранить все материалы лекции, т.е. видео, презентацию и пр. Сейчас там только
info.json, т.к. все грузится с внешних источников.
Думаю Вы лучше меня знаете, как включить курс в базу данных, но я бы это сделал
командой "mongoimport -d openitmo -c courses < [somepath]/CS0010/json/info.json"
из директории с MongoDB.
info.json в курсе CS0010 должен нормально скопироваться в коллекцию курсов.

Итак, первое что я сделал - я переделал общий view курса. Я вынес основные
вкладки в горизонтальное меню, так как на мой взгляд они являются крупными
разделами курса, и переключение между ними будет происходить значительно реже,
чем например между лекциями. Боковое меню я оставил именно для навигации по
вкладке. Шаблон я сделал только для лекций, где в левом меню собственно
список лекций, но мне кажется подобное было бы удобно и для форума, и для
"полки" (так и не понял, что же это). Такой вариант позволяет в один клик
переключаться между лекциями, или например между темами форума, что мне кажется
значительно удобнее, чем постоянно откатываться к исходному списку. А для
разделов, где нет никаких вложенный списков чего-нибудь (например для
онтологии), освобождается больше пространства.

Лекционная часть.
Управляется лекционная часть контроллером LectureCtrl, он по иерархии ниже, чем
LecturesCtrl и обявляется в шаблоне лекций lectures.html.

Видео-лекции, в соответствии с описанием, я сделал на Popcorn.js.
Для кастомных контролов я не стал придумывать велосипед, а взял вполне рабочий
плагин Acorn Media Player (http://ghinda.net/acornmediaplayer/). Не скажу, что
взял бы его в продакшен, тем более с Angular и Popcorn, но изобрести свое
никогда не поздно, а сейчас это все-таки не самое важное.
Управляется видео объектом video, он хранит все данные, и ссылку Popcorn-обертку
самого DOM элемента video.

С презентациями было много трудностей, ведь нельзя просто так взять и интегрировать
.ppt в html страницу, а хотелось бы презентации именно в power point, это позволит
сделать базу курсов на основе существующих наработок лекторов, да и просто удобно.
Не скажу, что проблему я решил, но в качестве рабочего варианта я сделал
презентации на основе API плеера от SlideShare
(http://www.slideshare.net/developers/playerapi). Они как-то умудряются переделы-
вать .ppt во flash, что конечно не лучший вариант, но это работает. В качестве
альтернативы есть еще подобный сервис http://ru.scribd.com/ , у них тоже есть
некоторое Api, но с ним я не разбирался. Самый крутой вариант это конечно
конвертировать ppt во что-нибудь самому, но это выходит за рамки моих знаний.
Как бы то ни было, презентации управляются объектом presentation, он так же
хранит всю информацию и ссылку на обертку DOM-элемента, которой достаточно
уметь листать слайды, переходить к слайду по номеру и возвращать значение
текущего слайда. Этого достаточно, чтобы синхронизировать видео и презентацию,
что я и сделал на API от slide share. Для синхронизации нужен массив syncArr в
info.json для лекции со значениями времени (в секундах) смены слайда. Первое
значение - это время смены 1го слайда.

Как и в предыдущей реализации видео, я решил добавить к виедо quiz (вопросы по
ходу лекции), мне кажется это полезный функционал. Quiz я старался сделать с
Angular подходом, у них есть один шаблон, а данные храняться в объекте quiz,
как и основные методы. Структуру quiz в info.json я оставил прежней. В текущей
реализации правильные ответы сохраняются, и эти quiz можно просмотреть, листая
видео или просматривая сначала. Убрать правильно отвеченные вопросы легко, для
этого в методе showQuiz есть комментарий и возможная реализация.

Кроме базовых объектов video, presentation и quiz в контроллере есть еще
объект fullScreen, позволяющий разворачивать область просмотра на весь экран.
Эта возможность есть, но она весьма сырая, и это скорее прототип прототипа, но
потестить можно.

Несколько вариантов просмотра.
Я долго думал над тем, как разместить на одной площадке видео и презентацию, и
как Вы можете заметить, ничего оригинального не придумал. Однако я решил, что
будет неплохо, если можно будет менять мажорный объект. И например сворачивать
минорный. Все эти манипуляции я оставил на Angular и в качестве кнопок управления
использовал различные input, а для изменения собственно view просто разные классы.
Не знаю, насколько это удачное решение, но по-моему в духе Angular, во всяком
случае не приходится самому дергать DOM и все прозрачно.

Из некоторых побочных вещей, я добавил сохранение последней просмотренной лекции
в cookies, эта информация отражается когда находишься непосредственно во вкладке
"Лекции". Думаю это полезно.
Так как CSS изрядно вырос, я решил вынести его в отдельный файл, оказалось
нужной функция, которая этот файл бы подключала. Вообще полный такой функционал
реализует фреймворк requierJS, думаю он Вам знаком, и мне кажется рано или
поздно он понадобится. И да, сами стили я писал на less, и очень его рекомендую,
ну или подобный препроцессор.
Еще я старался сделать все адаптивным, хотя это пожалуй громкое слово для
результата, но в принципе все тянется.

Вот пожалуй и весь обзор того, что я сделал.

Что хотелось бы видеть еще? На самом деле очень многое еще хотеллось бы изменить.
Например дизайн. Полностью дизайн. Bootstrap это конечно неплохо, но чтобы сделать
вторую coursera нужен крутой дизайн (не смотря, или даже именно потому, что
coursera сама на bootstrap). Тем более, что у нас в универе наверняка найдутся
крутые дизайнеры. И хороший UI тоже нужен как воздух, я как ни старался сделать
удобно, уверен можно и нужно удобнее.
Если ближе к тому, над чем работал я, то меня немного смущает неожиданное
появление quizов, было бы круто сделать по аналогии с coursera и отмечать их на
временной шкале видео, для этого надо полностью перелопатить плагин с контролами,
что конечно тоже надо сделать. Еще мне кажется неплохо было бы внедрить текст
лекции сюда же, на страницу. А так вообще простор для фич прям огромен.

Несколько слов о разных "странных" штуках.
Chrome+html5 video + Angular на выходе дал странный баг, который возможно у Вас
или на рабочем серве не повторится, но на localhost Chrome грузит видео стабильно
только в первый раз при открытии страницы, второй раз это же видео при переклю-
чении между лекциями будет загружено только если какая-то часть его была прогруженна.
Без этого chrome бросает запрос, но повисает вечный (или просто очень долгий)
pending. Отчасти поэтому стоит autoplay, с ним все работает.
Со SlideShare тоже нюансы, эти ребята оказались не очень честными, и потому там
в коде есть одно уж очень плохое место. Да и в целом с их плеером пришлось
пободаться, потому если увидите что-то совсем непонятное, скорее всего это что-то
борется с плеером.


Вот вроде бы и все.

Feedback или вопросы я жду на почте:
avanal@mail.ru,
отвечу и по телефону: +79052862477

С пожеланиями успеха,
Аверьянов Андрей. КТУ, СУИ, гр. 4148.

